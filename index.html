<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASR New Year Final</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Montserrat:wght@300&display=swap');

        body {
            background-color: #010101; /* Hitam pekat */
            color: #e0e0e0;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* Mencegah scrollbar browser ganda */
            font-family: 'Playfair Display', serif;
            position: relative;
        }

        /* Canvas Kembang Api (Di belakang teks) */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Paling belakang */
            pointer-events: none;
            opacity: 0.7; /* Dibuat agak transparan biar gak ganggu */
        }

        /* Vignette untuk fokus ke tengah */
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 40%, #000 120%);
            pointer-events: none; z-index: 1;
        }

        /* Container Puisi (Scrollable) */
        #poem-container {
            position: relative;
            z-index: 10; /* Di depan kembang api */
            height: 100vh;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            overflow-y: auto; /* Scroll aktif */
            padding: 50vh 25px; /* Padding besar biar bisa scroll tengah */
            box-sizing: border-box;
            display: none; /* Hidden awal */
            scroll-behavior: smooth;
             /* Sembunyikan scrollbar di Firefox */
            scrollbar-width: none;
        }
        /* Sembunyikan scrollbar di Chrome/Safari */
        #poem-container::-webkit-scrollbar { display: none; }

        /* Item Baris Puisi */
        .line-item {
            text-align: center;
            margin-bottom: 60px; /* Jarak antar bait lebih lega */
            opacity: 0.1; /* Sangat redup kalau tidak aktif */
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform: scale(0.95);
            filter: blur(4px);
        }

        /* Saat Aktif (Ngomong) */
        .line-item.active {
            opacity: 1;
            transform: scale(1.1);
            filter: blur(0);
        }

        .text-en {
            font-size: 1.6rem;
            color: #fff;
            margin-bottom: 12px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        
        /* Opening Special Style */
        .line-item.opening .text-en {
             font-family: 'Cinzel', serif;
             font-size: 2rem;
             color: #d4af37; /* Full Gold untuk opening */
        }

        .line-item.active .text-en {
            color: #d4af37; /* Emas menyala */
            text-shadow: 0 0 25px rgba(212, 175, 55, 0.7), 0 0 10px rgba(0,0,0,1);
        }

        .text-id {
            font-family: 'Montserrat', sans-serif;
            font-size: 0.95rem;
            color: #888;
            font-style: italic;
            letter-spacing: 1px;
        }

        .line-item.active .text-id {
            color: #ccc;
        }

        /* Tombol Mulai di Tengah */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 50;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s;
        }
        #start-btn {
            padding: 20px 40px;
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            background: #d4af37; color: #000; border: none; border-radius: 8px;
            cursor: pointer; box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
            transition: 0.3s;
        }
        #start-btn:hover:not(:disabled) { transform: scale(1.05); background: #fff; }
        #start-btn:disabled { background: #555; color: #888; cursor: wait; transform: scale(1); box-shadow: none;}
        #loading-text { margin-top: 20px; color: #d4af37; font-family: 'Montserrat', sans-serif; font-style: italic; min-height: 25px;}
    </style>
</head>
<body>

    <audio id="bg-music" loop preload="auto">
        <source src="https://www.scottbuckley.com.au/library/wp-content/uploads/2021/09/sb_solstice.mp3" type="audio/mpeg">
    </audio>

    <canvas id="fireworks"></canvas>
    <div class="vignette"></div>

    <div id="start-overlay">
        <button id="start-btn" onclick="beginExperience()">MULAI PERTUNJUKAN 2026</button>
        <div id="loading-text"></div>
    </div>

    <div id="poem-container"></div>

    <script>
        // =========================================
        // AREA GANTI API KEY (WAJIB DIISI!)
        // =========================================
        // Ganti tulisan PASTE_API_KEY_DISINI dengan key aslimu.
        // Jangan hapus tanda kutipnya ("").
        const ELEVENLABS_API_KEY = "sk_16cf70d8a2950ed389cf38873a9027ac96d52c4d39c8d729"; 
        // =========================================

        const VOICE_ID = "onwK4e9ZLuTAKqWW03F9"; // Daniel Voice

        // Data Lengkap (Opening + Puisi)
        const poemData = [
            // --- OPENING ---
            { en: "The old year fades tonight.", id: "Tahun yang lama memudar malam ini.", type: "opening" },
            { en: "Happy New Year, 2026.", id: "Selamat Tahun Baru, 2026.", type: "opening" },
            
            // --- PUISI INTI ---
            { en: "Let the night swallow our remaining breath.", id: "Biarkan malam ini menelan sisa napas kita." },
            { en: "Do not turn on the lights.", id: "Jangan nyalakan lampu." },
            { en: "We are comfortable in the blur.", id: "Kita lebih nyaman di dalam samar." },
            { en: "You and I know...", id: "Kau dan aku tahu..." },
            { en: "We seek no bright and easy path.", id: "Kita tak mencari jalan yang terang dan mudah." },
            { en: "We fell in love with the misleading road.", id: "Kita jatuh cinta pada jalan yang menyesatkan." },
            { en: "With the fatigue that bites the bones,", id: "Pada lelah yang menggigit tulang," },
            { en: "With the longing that strangles the neck...", id: "Pada rindu yang mencekik leher..." },
            { en: "Yet never kills.", id: "Namun tak pernah membunuh." },
            { en: "Just admit it.", id: "Akui saja." },
            { en: "You enjoy the pain of waiting.", id: "Kau menikmati rasa sakit menunggu ini." },
            { en: "You enjoy every heartbeat while gambling with fate.", id: "Kau nikmati detak jantung saat bertaruh nasib." },
            { en: "It is not a burden.", id: "Itu bukan beban." },
            { en: "It is desire.", id: "Itu gairah." },
            { en: "Don't look back.", id: "Jangan menoleh lagi." },
            { en: "What's behind is gone. Dried up.", id: "Yang di belakang sudah habis. Kering." },
            { en: "Look at him standing at the edge of the mist.", id: "Lihat dia berdiri di ujung kabut itu." },
            { en: "A stranger. Cold. Arrogant. Tempting.", id: "Sosok asing. Dingin. Angkuh. Menggoda." },
            { en: "He promises no light.", id: "Dia tak menjanjikan cahaya." },
            { en: "He offers a riddle that makes you hunger.", id: "Dia menawarkan teka-teki yang membuatmu lapar." },
            { en: "And we will come to him.", id: "Dan kita akan datang padanya." },
            { en: "Not to knock politely,", id: "Bukan untuk mengetuk sopan," },
            { en: "But to break in and claim him.", id: "Tapi untuk mendobrak dan memilikinya." },
            { en: "Until the end.", id: "Sampai habis." }
        ];

        let audioBlobs = [];
        const startBtn = document.getElementById('start-btn');
        const loadingText = document.getElementById('loading-text');
        const startOverlay = document.getElementById('start-overlay');
        const container = document.getElementById('poem-container');
        const bgMusic = document.getElementById('bg-music');

        // Render Awal (Semua tampil tapi redup)
        poemData.forEach((data, index) => {
            const div = document.createElement('div');
            // Tambah class 'opening' jika tipe datanya opening
            div.className = `line-item ${data.type === 'opening' ? 'opening' : ''}`;
            div.id = `line-${index}`;
            div.innerHTML = `
                <div class="text-en">${data.en}</div>
                <div class="text-id">${data.id}</div>
            `;
            container.appendChild(div);
        });

        async function beginExperience() {
            if (ELEVENLABS_API_KEY === "PASTE_API_KEY_DISINI" || !ELEVENLABS_API_KEY) {
                alert("ERROR: Kamu belum memasukkan API Key di dalam kodingan HTML-nya! Edit file ini dulu.");
                return;
            }

            startBtn.disabled = true;
            startBtn.innerText = "MENYIAPKAN SUARA...";
            
            // Coba play musik di awal interaksi (biar browser mengizinkan audio)
            bgMusic.volume = 0; // Play tapi silent dulu
            bgMusic.play().catch(() => {}); 

            try {
                audioBlobs = [];
                for (let i = 0; i < poemData.length; i++) {
                    loadingText.innerText = `Mengunduh bagian ${i + 1} dari ${poemData.length}...`;
                    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
                        method: "POST",
                        headers: { "xi-api-key": ELEVENLABS_API_KEY, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            text: poemData[i].en,
                            model_id: "eleven_multilingual_v2", 
                            voice_settings: { stability: 0.5, similarity_boost: 0.75, style: 0.45 }
                        })
                    });
                    if (!response.ok) throw new Error("Gagal Download dari ElevenLabs");
                    const blob = await response.blob();
                    audioBlobs.push(URL.createObjectURL(blob));
                    // Delay kecil untuk mencegah rate limit
                    await new Promise(r => setTimeout(r, 80)); 
                }

                loadingText.innerText = "Selesai! Memulai...";
                
                // Fade out overlay
                startOverlay.style.opacity = 0;
                setTimeout(() => {
                    startOverlay.style.display = 'none';
                    container.style.display = 'block';
                    // Masuk Fullscreen
                    if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
                    
                    startFireworks();
                    
                    // Mulai Musik (Volume Naik Perlahan)
                    bgMusic.currentTime = 0;
                    bgMusic.volume = 0.3; // Target volume 30%
                    bgMusic.play();

                    // Mulai Narasi setelah intro musik 2.5 detik
                    setTimeout(() => playSequence(0), 2500);
                }, 800);

            } catch (error) {
                alert("Error: " + error.message + "\nCek API Key atau koneksi internet.");
                startBtn.disabled = false;
                startBtn.innerText = "COBA LAGI";
                loadingText.innerText = "";
            }
        }

        function playSequence(index) {
            if (index >= poemData.length) {
                // Selesai: Fade out musik
                let vol = bgMusic.volume;
                let fade = setInterval(() => {
                    if (vol > 0) { vol -= 0.02; bgMusic.volume = Math.max(0, vol); }
                    else { clearInterval(fade); bgMusic.pause(); }
                }, 100);
                return;
            }

            // Reset highlight
            document.querySelectorAll('.line-item').forEach(el => el.classList.remove('active'));
            
            // Highlight baris aktif
            const currentLine = document.getElementById(`line-${index}`);
            if (currentLine) {
                currentLine.classList.add('active');
                // Scroll otomatis ke tengah layar
                currentLine.scrollIntoView({ behavior: "smooth", block: "center" });
            }

            // Play Narasi
            const audio = new Audio(audioBlobs[index]);
            audio.volume = 1.0; 
            audio.play().catch(e => console.log(e));

            // Jeda antar kalimat berdasarkan panjang kalimat
            const wordCount = poemData[index].en.split(' ').length;
            const dynamicDelay = (wordCount > 5) ? 800 : 500;

            audio.onended = () => {
                setTimeout(() => playSequence(index + 1), dynamicDelay);
            };
            audio.onerror = () => setTimeout(() => playSequence(index + 1), 2000);
        }

        // --- FIREWORKS (Subtle Gold) ---
        function startFireworks() {
            const canvas = document.getElementById('fireworks');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particles = [];
            
            function createFirework(x, y) {
                const count = 30; // Jumlah partikel dikurangi biar gak rame
                for (let i = 0; i < count; i++) {
                    particles.push({
                        x: x, y: y,
                        vx: (Math.random() - 0.5) * 5, vy: (Math.random() - 0.5) * 5,
                        alpha: 0.8, // Mulai agak transparan
                        decay: Math.random() * 0.015 + 0.01, // Cepat pudar
                        color: `hsl(${35 + Math.random() * 15}, 80%, 55%)` // Gold/Amber halus
                    });
                }
            }

            function animate() {
                // Trail effect lebih pekat biar kembang api cepat hilang
                ctx.fillStyle = 'rgba(1, 1, 1, 0.25)'; 
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Kembang api muncul lebih jarang dan di area atas
                if (Math.random() < 0.02) {
                    createFirework(Math.random() * canvas.width, Math.random() * canvas.height * 0.4);
                }

                particles.forEach((p, index) => {
                    p.x += p.vx; p.y += p.vy; p.alpha -= p.decay; p.vy += 0.04; // Gravity
                    ctx.globalAlpha = p.alpha; ctx.fillStyle = p.color;
                    ctx.beginPath(); ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2); ctx.fill();
                    if (p.alpha <= 0) particles.splice(index, 1);
                });
                requestAnimationFrame(animate);
            }
            animate();
        }
        
        // Resize canvas kalau layar diputar
        window.addEventListener('resize', () => {
             const canvas = document.getElementById('fireworks');
             canvas.width = window.innerWidth;
             canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
